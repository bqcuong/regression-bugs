<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.3.xsd">

	<changeSet author="peter@peterphi.com" id="create_acme_ca_tables">
		<createTable tableName="acme_ca_account">
			<column name="id" type="INT">
				<constraints primaryKey="true" primaryKeyName="PK_acme_ca_account"/>
			</column>
			<column name="keypair_utf8" type="BLOB">
				<constraints nullable="false"/>
			</column>
			<column name="created_ts" type="BIGINT">
				<constraints nullable="false"/>
			</column>
			<column name="updated_ts" type="BIGINT">
				<constraints nullable="false"/>
			</column>
		</createTable>
		<createTable tableName="acme_ca_cert">
			<column name="id" type="VARCHAR(600)">
				<constraints primaryKey="true" primaryKeyName="PK_acme_ca_cert"/>
			</column>
			<column name="keypair_utf8" type="BLOB">
				<constraints nullable="false"/>
			</column>
			<column name="cert_utf8" type="BLOB">
				<constraints nullable="false"/>
			</column>
			<column name="chain_utf8" type="BLOB">
				<constraints nullable="false"/>
			</column>
			<column name="expires_ts" type="BIGINT">
				<constraints nullable="false"/>
			</column>
			<column name="created_ts" type="BIGINT">
				<constraints nullable="false"/>
			</column>
			<column name="updated_ts" type="BIGINT">
				<constraints nullable="false"/>
			</column>
		</createTable>
	</changeSet>

	<changeSet author="peter@peterphi.com" id="add_mgmt_token_to_acme_ca_cert" >
		<!-- current -->
		<validCheckSum>7:798668bcb07521f9932e05e816436746</validCheckSum>
		<validCheckSum>7:b4a3364079a3ac2588212c6817b7d451</validCheckSum>

		<addColumn tableName="acme_ca_cert">
			<column name="mgmt_token" type="VARCHAR(32)">
			</column>
		</addColumn>
	</changeSet>
</databaseChangeLog>
